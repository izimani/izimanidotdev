---
import { BaseLayout } from "../../layouts";
import { DecorationBar, Time } from "../../components/common";
import { getSortedLivePosts } from "../../posts";
import type { CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  function postToPath(post: CollectionEntry<"posts">) {
    return {
      params: {
        id: post.id,
      },
      props: {
        post,
      },
    };
  }

  return (await getSortedLivePosts()).map(postToPath);
}

interface Props {
  post: CollectionEntry<"posts">;
}

const { post } = Astro.props;
---

<style>
  :root {
    --page-margin: 4rem 0;
    --content-side-margin: 20px;
    --title-size: 3rem;
    --subtitle-size: 1.5rem;
    --title-color: var(--color-deep-emerald);
    --content-width: 700px;
    --escape-width: 80%;

    @media (max-width: 768px) {
      --page-margin: 20px 0;
      --content-width: calc(100% - 2 * var(--content-side-margin));
      --escape-width: var(--content-width);
    }
  }

  body {
    margin: var(--page-margin);
  }

  .to-center {
    display: grid;
    grid-template-columns:
      minmax(var(--content-side-margin), 1fr) var(--content-width)
      minmax(var(--content-side-margin), 1fr);

    & > * {
      grid-column: 2 / 3;
    }
  }

  .nav {
    padding: 0 0 2rem 0;
    font-size: 0.8rem;
    font-family: var(--flow-font);
    font-weight: 300;

    & > a {
      text-decoration: none;
      color: var(--color-charcoal);
      transition: color 0.3s ease;

      &:hover {
        color: var(--color-deep-emerald);
      }

      &::before {
        content: "\2190";
        margin-right: 1ch;
      }
    }
  }

  .header {
    padding-bottom: 1.5rem;
    gap: 1.5rem 0;

    @media (max-width: 1300px) {
      padding-bottom: 0rem;
    }
  }

  .title {
    font-size: var(--title-size);
    font-weight: 800;
    font-family: var(--font-vollkorn);
    color: var(--title-color);
    line-height: 1.05;
    text-wrap: balance;

    &::selection {
      background-color: var(--color-deep-emerald);
      color: var(--color-paper-beige);
    }
  }

  .subtitle {
    font-size: var(--subtitle-size);
    font-weight: 400;
    font-family: var(--font-vollkorn);
    color: var(--color-dim-grey);
    line-height: 1.5;
    text-wrap: balance;

    &::selection {
      background-color: var(--color-dim-grey);
      color: var(--color-paper-beige);
    }
  }

  .metadata {
    padding-top: 0.25rem;
    display: flex;
    flex-flow: column wrap;
    align-items: end;
    justify-content: start;
    font-size: 0.8rem;
    line-height: 1.5;
    font-family: var(--flow-font);
    font-weight: 300;
    color: var(--color-charcoal);
    padding-right: 1rem;
    padding-left: 10px;

    & :global(*)::selection {
      background-color: var(--color-charcoal);
      color: var(--color-paper-beige);
    }
  }

  .content > .metadata {
    grid-column: 1 / 1;

    @media (max-width: 1300px) {
      grid-column: 2 / 3;
      flex-flow: row wrap;
      gap: 0.5rem;
      justify-content: flex-start;
      padding-left: 0;
      padding-right: 0;

      & > .metadata-separator::before {
        content: "â€¢";
        color: var(--color-dim-grey);
      }
    }
  }

  .author {
    color: var(--color-charcoal);
    text-decoration: underline;
    transition: color 0.3s ease;

    &:hover {
      color: var(--color-deep-emerald);
    }
  }
</style>
<style is:global>
  .content {
    font-family: var(--flow-font);
    color: var(--color-charcoal);

    & > :is(img) {
      grid-column: 1 / -1 !important;
      margin-left: auto;
      margin-right: auto;
      width: var(--escape-width);
      height: auto;
    }

    & > p {
      line-height: 1.5;

      &::selection {
        background-color: var(--color-charcoal);
        color: var(--color-paper-beige);
      }
    }

    & > :not(:last-child) {
      margin-bottom: 1rem;
    }

    & > aside {
      font-size: 0.8rem;
      color: var(--color-dim-grey);
      padding: 0.75rem 0;
      border-top: 1px solid var(--color-pale-slate);
      border-bottom: 1px solid var(--color-pale-slate);
      overflow-y: auto;
      word-wrap: nowrap;
    }
  }
</style>
<BaseLayout title={post.data.title} description={post.data.excerpt}>
  <nav class="nav to-center">
    <a href="/posts">All posts on izimani</a>
  </nav>
  <header class="header to-center">
    <hgroup>
      <h1 class="title">{post.data.title}</h1>
      <p class="subtitle">{post.data.excerpt}</p>
    </hgroup>
    <div>
      <DecorationBar />
    </div>
  </header>
  <main>
    <div class="content to-center">
      <div class="metadata">
        <span>
          by <a href="/" class="author">Attila Bagossy</a>
        </span>
        <span class="metadata-separator"></span>
        {
          post.data.updated && (
            <span>
              last updated <Time date={post.data.updated} />
            </span>
          )
        }
        <span>
          {post.data.updated && "originally "} published <Time
            date={post.data.date}
          />
        </span>
        <span class="metadata-separator"></span>
        <span> 15 mins </span>
      </div>
      <p>
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Possimus omnis
        nulla iusto laborum repudiandae laboriosam dicta minus obcaecati natus
        molestiae quidem ad fuga sequi odio nesciunt, atque distinctio unde ea!
      </p>
      <p>
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Possimus omnis
        nulla iusto laborum repudiandae laboriosam dicta minus obcaecati natus
        molestiae quidem ad fuga sequi odio nesciunt, atque distinctio unde ea!
      </p>
      <img src="https://picsum.photos/1024/768" alt="Random image" />
      <p>
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Possimus omnis
        nulla iusto laborum repudiandae laboriosam dicta minus obcaecati natus
        molestiae quidem ad fuga sequi odio nesciunt, atque distinctio unde ea!
      </p>
      <aside>
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Possimus omnis.
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Possimus omnis.
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Possimus omnis.
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Possimus omnis.
      </aside>
      <p>
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Possimus omnis
        nulla iusto laborum repudiandae laboriosam dicta minus obcaecati natus
        molestiae quidem ad fuga sequi odio nesciunt, atque distinctio unde ea!
      </p>
    </div>
  </main>
</BaseLayout>
